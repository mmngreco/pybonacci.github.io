<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Pybonacci">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Desarrollo Dirigido por Pruebas en Python (III). Independencia del Sistema | Pybonacci</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" title="Pybonacci blog atom feed" href="/feeds/all.atom.xml" />
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/theme/css/fontello.css"/>
        <style>.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #60a0b0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40a070 } /* Literal.Number */
.highlight .s { color: #4070a0 } /* Literal.String */
.highlight .na { color: #4070a0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60add5 } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287e } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #bb60d5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #40a070 } /* Literal.Number.Float */
.highlight .mh { color: #40a070 } /* Literal.Number.Hex */
.highlight .mi { color: #40a070 } /* Literal.Number.Integer */
.highlight .mo { color: #40a070 } /* Literal.Number.Oct */
.highlight .sb { color: #4070a0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070a0 } /* Literal.String.Char */
.highlight .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070a0 } /* Literal.String.Double */
.highlight .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070a0 } /* Literal.String.Heredoc */
.highlight .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #c65d09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070a0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #bb60d5 } /* Name.Variable.Class */
.highlight .vg { color: #bb60d5 } /* Name.Variable.Global */
.highlight .vi { color: #bb60d5 } /* Name.Variable.Instance */
.highlight .il { color: #40a070 } /* Literal.Number.Integer.Long */</style>
        <style>.description-author {
  font-size: 0.8em;
  color: #333;
}
.img-author {
  max-height: 10em;
  max-width: 10em;
}
body {
  margin: 0;
  padding: 0;
  font: 15px 'Source Sans Pro', sans-serif;
  line-height: 1.6em;
  color: #222222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
a {
  color: #007ee5;
  text-decoration: none;
}
a:hover {
  color: #007ee5;
  text-decoration: none;
}
header.main-header {
  background: none repeat scroll 0% 0% #205F29;
  margin-bottom: 0px;
}
header.main-header a {
  color: #fff;
}
header.main-header .container {
  max-width: 1000px;
}
header.main-header .container nav a:hover {
  background-color: #5C881C;
}
header.navbar-default {
  border-bottom: none;
  background-color: #EFEFEF;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p {
  font-size: 2em;
  margin-bottom: 20px;
  line-height: 1.6em;
  text-align: justify;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article ul,
article ol {
  margin-top: 0px;
  margin-bottom: 25px;
}
article li {
  font-size: 16px;
  line-height: 1.6em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article img {
  max-width: 100%;
}
article code {
  color: #333;
  background-color: #EEE;
  border-radius: 0;
  font-size: 1em;
}
article .meta {
  margin-top: 35px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta div {
  display: block;
}
article .meta address:before,
article .meta time:before,
article .meta a.tag:before {
  font-family: 'fontello';
  margin-right: 6px;
}
article .meta address.author {
  float: left;
}
article .meta address:before {
  content: '\e819';
}
article .meta time:before {
  content: '\f133';
}
article .meta div.tags {
  clear: both;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:before {
  content: '\e821';
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 14px;
  font-weight: 800;
  padding: 10px 20px;
  color: #007aa3;
  background: #FFF;
  border: 1px solid #007aa3;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  background: #007aa3;
}
article .meta:after {
  content: "";
  display: table;
  clear: both;
}
.index {
  max-width: 700px;
}
.index article header h2 {
  font-size: 36px;
  margin-bottom: 2px;
  font-weight: 700;
}
.index article header h2 a {
  color: #333;
}
.index article header h2 a:hover {
  color: #007ee5;
  text-decoration: none;
}
.index .separator {
  padding: 40px 0 0 0;
  margin: 0 0 40px 0;
  height: 10px;
  border-bottom: solid 1px #CCC;
}
.index .pagination {
  display: block;
  margin-bottom: 100px;
}
.index .pagination .left {
  text-align: right;
}
.index .pagination .right {
  text-align: left;
}
.index .pagination a {
  display: inline-block;
  border: 2px solid #5C881C;
  margin: 0 5px;
  padding: 8px 20px;
  font-weight: bold;
  color: #5C881C;
}
.index .pagination a:hover {
  color: #FFF;
  background: #5C881C;
}
.post {
  max-width: 80%;
}
.post h1 {
  font-size: 42px;
}
.post h2:before {
  content: "# ";
  font-weight: bold;
  color: #DDD;
}
.post h3:before {
  content: "## ";
  font-weight: bold;
  color: #DDD;
}
.post h4:before {
  content: "### ";
  font-weight: bold;
  color: #DDD;
}
.post p {
  font-size: 2em;
}
.list {
  max-width: 700px;
}
.list ul.double-list {
  margin: 0 auto 60px;
  padding: 0;
  list-style-type: none;
}
.list ul.double-list li {
  padding: 5px 0;
}
.list ul.double-list li h2 {
  font-size: 2em;
  display: inline;
  font-weight: normal;
}
.list ul.double-list li span {
  font-family: sans-serif;
  text-transform: uppercase;
  text-align: right;
  float: right;
  padding-top: 3px;
  font-size: 12px;
  color: #999;
}
.full-width-content {
  padding-top: 10px;
  padding-left: 0px;
  padding-right: 0px;
  margin-left: -20px;
  margin-right: -20px;
}
.col-xs-1,
.col-sm-1,
.col-md-1,
.col-lg-1,
.col-xs-2,
.col-sm-2,
.col-md-2,
.col-lg-2,
.col-xs-3,
.col-sm-3,
.col-md-3,
.col-lg-3,
.col-xs-4,
.col-sm-4,
.col-md-4,
.col-lg-4,
.col-xs-5,
.col-sm-5,
.col-md-5,
.col-lg-5,
.col-xs-6,
.col-sm-6,
.col-md-6,
.col-lg-6,
.col-xs-7,
.col-sm-7,
.col-md-7,
.col-lg-7,
.col-xs-8,
.col-sm-8,
.col-md-8,
.col-lg-8,
.col-xs-9,
.col-sm-9,
.col-md-9,
.col-lg-9,
.col-xs-10,
.col-sm-10,
.col-md-10,
.col-lg-10,
.col-xs-11,
.col-sm-11,
.col-md-11,
.col-lg-11,
.col-xs-12,
.col-sm-12,
.col-md-12,
.col-lg-12 {
  padding-right: 0px;
  padding-left: 0px;
}
.disclaimer {
  text-align: center;
  background-color: #EFEFEF;
  border-bottom: none;
  margin-top: 6em;
}</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?..." type="text/javascript"></script>
        <script type="text/javascript">
        init_mathjax = function() {
            if (window.MathJax) {
                // MathJax loaded
                MathJax.Hub.Config({
                    tex2jax: {
                        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                    },
                    displayAlign: 'left', // Change this to 'center' to center equations.
                    "HTML-CSS": {
                        styles: {'.MathJax_Display': {"margin": 0}}
                    }
                });
                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            }
        }
        init_mathjax();
        </script>

    </head>

    <body>
        <header class="navbar navbar-default bs-docs-nav">
            <div class="container-fluid">
                <div class="navbar-header">
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span> 
		  </button>
                  <a class="navbar-brand" href="/" title="Home" class="title">Pybonacci</a><!-- — Python y Ciencia-->
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
		    <ul class="nav navbar-nav navbar-right">
                            <li><a href="/pages/acerca-de-pybonacci.html" title="About">Acerca de</a></li>
                            <li><a href="/archives.html" title="Archive">Archivos</a></li>
                            <li><a class="nodec icon-rss" href="/feeds/all.atom.xml" title="pybonacci.github.io RSS feed" rel="me"></a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>Desarrollo Dirigido por Pruebas en Python (III). Independencia del Sistema</h1>
            <div class="meta">
                <time datetime="article.date.isoformat()" pubdate>mar 03 diciembre 2013</time>
                <address class="vcard author">Por
                    <a class="url fn" href="http://pybonacci.github.io/author/javierjus.html">javierjus</a>
                </address>
            </div>
        </header>

        <div class="article_content">
            <p>En esta entrega continuamos aplicando desarrollo dirigido por pruebas (o Test-Driven Development en inglés) para implementar una aplicación que busque tweets con un hashtag concreto y los guarde en un archivo. En concreto nos centraremos en el código que construye el nombre del fichero con la fecha actual y el hashtag buscado.</p>
<p>Nos enfrentaremos con el problema de depender de la fecha del sistema por lo que el resultado esperado de la pruebas cambiará cada día. Para solucionarlo, veremos cómo podemos independizar nuestro código de detalles del sistema y hacerlo más fácil de probar. Esto nos dará pie a presentar los dobles de prueba.</p>
<p>Las entregas anteriores de esta serie son:</p>
<p><a href="http://pybonacci.org/2013/01/07/desarrollo-dirigido-por-pruebas-en-python-i-una-historia-que-pasa-todos-los-dias/#more-1352" title="Desarrollo dirigido por pruebas en Python (I): Una historia que pasa todos los días">Desarrollo dirigido por pruebas en Python (I): Una historia que pasa todos los días</a></p>
<p><a href="http://pybonacci.org/2013/06/19/desarrollo-dirigido-por-pruebas-en-python-ii-un-caso-practico-i/" title="Desarrollo Dirigido por Pruebas en Python (II). Un Caso Práctico (I)">Desarrollo Dirigido por Pruebas en Python (II). Un Caso Práctico (I)</a></p>
<p>Aunque la aplicación es la misma en todas las entregas, en cada una nos centramos en un problema concreto, así que puedes leer esta entrega aunque no hayas leído las dos anteriores.</p>
<h2><strong>El diario de diseño</strong></h2>
<p>Vamos a recuperar nuestro diario de diseño de la entrega anterior para ver en qué estado se encuentra el desarrollo de nuestra aplicación.</p>
<table border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td valign="top" width="576">
      <b>Diario de diseño.</b>
    </td>
  </tr>

  <tr>
    <td valign="top" width="576">
      1) Conectarse a Internet y obtener los mensajes que contengan un tag concreto.<span style="text-decoration:line-through;">2) Procesar los tweets para obtener el nombre y dirección twitter del autor, la fecha y el contenido del tweet.</span></p> 

      <p style="padding-left:30px;">
        <span style="text-decoration:line-through;">2.1) Definir el contenido de tweetDePrueba</span>
      </p>

      <p style="padding-left:30px;">
        <span style="text-decoration:line-through;">2.2) Los elementos de la lista resultante deben tener el nombre y dirección twitter del autor, la fecha y el contenido del tweet. </span>
      </p>

      <p>
        3) Guardar la información anterior en un nuevo fichero
      </p>

      <p>
        4) Crear una interfaz de usuario por línea de comandos.</td> </tr> </tbody> </table>

<div class="highlight"><pre><span></span>    <span class="nt">&lt;p&gt;</span>
      Ya hemos terminado la funcionalidad 2. Ahora podemos elegir la tarea que quieras implementar. Para esta entrada, vamos a elegir la tarea 3. Al igual que hicimos en la entrega anterior, vamos a descomponer esta área en otras más pequeñas:
    <span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;0&quot;</span> <span class="na">cellpadding=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;b&gt;</span>Diario de diseño.<span class="nt">&lt;/b&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>

      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
          1) Conectarse a Internet y obtener los mensajes que contengan un tag concreto.<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration:line-through;&quot;</span><span class="nt">&gt;</span>2) Procesar los tweets para obtener el nombre y dirección twitter del autor, la fecha y el contenido del tweet.<span class="nt">&lt;/span&gt;</span>3) Guardarlos tweets procesados en un nuevo fichero<span class="nt">&lt;/p&gt;</span>

          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
            3.1) Crear el nombre de fichero siguiendo este formato: “año-mes-dia tag.txt”
          <span class="nt">&lt;/p&gt;</span>

          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
            3.2) Cada tweet se guarda en una línea con los valores separados por comas.
          <span class="nt">&lt;/p&gt;</span>

          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
            3.3) Crear el fichero con el nombre y contenido indicados en 3.1 y 3.2
          <span class="nt">&lt;/p&gt;</span>

          <span class="nt">&lt;p&gt;</span>
            4) Crear una interfaz de usuario por línea de comandos.<span class="nt">&lt;/td&gt;</span> <span class="nt">&lt;/tr&gt;</span> <span class="nt">&lt;/tbody&gt;</span> <span class="nt">&lt;/table&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Como se describe en el diario de diseño, vamos a crear un fichero cuyo nombre contenga la fecha del sistema. A continuación empezamos a implementar nuestra nueva funcionalidad escribiendo pruebas.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;h2&gt;</span>
              <span class="nt">&lt;b&gt;</span>La primera prueba<span class="nt">&lt;/b&gt;</span>
            <span class="nt">&lt;/h2&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Una vez qué tenemos claro qué vamos a hacer, el primer paso es escribir una prueba para expresar el resultado esperado del código que vamos a escribir. Empezamos generando el nombre adecuado de un fichero y, para ello, escribiremos una prueba que exponga cómo lo queremos obtener.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TestTweetsEnFichero(unittest.TestCase):
def testCreaNombreFichero(self):
    tef = TweetsEnFichero()
    esperado = &quot;2013-03-30 PyConEs.txt&quot;
    self.assertEquals(esperado, tef.crearNombreFichero(&quot;PyConEs&quot;))<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Para que esta prueba pase, creamos una nueva clase, <span class="nt">&lt;em&gt;</span>TweetsEnFichero<span class="nt">&lt;/em&gt;</span>, que contendrá todo lo necesario para almacenar el contenido de los tweets en un fichero. Suponemos que escribimos y ejecutamos esta prueba el 30/03/2013. La implementación más sencilla para que esta prueba pase es:
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def crearNombreFichero(self, tag):
    return  &quot;2013-03-30 PyConEs.txt&quot;<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Con esta implementación tenemos el código más sencillo que hace que la prueba pase con éxito. Ahora que ya tenemos algo que funciona y que nos muestra cómo trabajar vamos a mejorarlo. Podemos hacer algunas refactorizaciones al código anterior. Por ejemplo, ya que tenemos el hashtag, podemos utilizarlo y comprobar que la prueba sigue funcionando.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def crearNombreFichero(self, tag):
    return  &quot;2013-03-30 “+tag+”.txt&quot;<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Veamos a continuación cómo podemos independizarnos de la fecha actual.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;h2&gt;</span>
              <span class="nt">&lt;b&gt;</span>¡Independencia!... del día y la hora                      <span class="nt">&lt;/b&gt;</span>
            <span class="nt">&lt;/h2&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Comenzamos separando la responsabilidad de obtener la fecha darle el formato adecuado del resto del código. Para ello vamos a escribir un nuevo método y nuestro primer paso, lógicamente, será escribir primero la prueba que nos defina qué debe hacer el código que vamos a escribir.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def testGetFechaActual(self):
    tef = TweetsEnFichero()
    esperado = &quot;2013-03-30&quot;
    self.assertEquals(esperado, tef.getFechaActual())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Una vez que la prueba falla pasamos a la implementación. Veamos el código.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def getFechaActual(self):
    now = datetime.now()
    return str(now.year) + &quot;-&quot; + str(now.month) + &quot;-&quot; + str(now.day)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Sin embargo con la implementación anterior la prueba falla porque el mes es 3 en vez de 03. Esto también pasará cuando el día sea menor de 10. Como esta prueba no pasa con éxito no podemos dar por terminada la implementación. La solución más rápida es añadir el “0” que falta, como se muestra en el siguiente código.
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def getFechaActual(self):
    now = datetime.now()
    return str(now.year) + &quot;-&quot; + “0” + str(now.month) + &quot;-&quot; + str(now.day)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

            <span class="nt">&lt;p&gt;</span>
              Ahora la prueba pasa con éxito. Además, hemos descubierto una nueva tarea que necesitamos para que el nombre se genere correctamente, y que añadimos a nuestro diario (tarea 3.4).
            <span class="nt">&lt;/p&gt;</span>

            <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;0&quot;</span> <span class="na">cellpadding=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;b&gt;</span>Diario de diseño.<span class="nt">&lt;/b&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
              <span class="nt">&lt;/tr&gt;</span>

              <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
                  1) Conectarse a Internet y obtener los mensajes que contengan un tag concreto.<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration:line-through;&quot;</span><span class="nt">&gt;</span>2) Procesar los tweets para obtener el nombre y dirección twitter del autor, la fecha y el contenido del tweet.<span class="nt">&lt;/span&gt;</span>3) Guardarlos tweets procesados en un nuevo fichero3.1) Crear el nombre de fichero siguiendo este formato: “año-mes-día tag.txt”<span class="nt">&lt;/p&gt;</span>

                  <span class="nt">&lt;p&gt;</span>
                    3.2) Cada tweet se guarda en una línea con los valores separados por comas.
                  <span class="nt">&lt;/p&gt;</span>

                  <span class="nt">&lt;p&gt;</span>
                    3.3) Crear el fichero con el nombre y contenido indicados en 3.1 y 3.2
                  <span class="nt">&lt;/p&gt;</span>

                  <span class="nt">&lt;p&gt;</span>
                    3.4) Añadir un “0” cuando el mes o el día sean menores de 10.
                  <span class="nt">&lt;/p&gt;</span>

                  <span class="nt">&lt;p&gt;</span>
                    4) Crear una interfaz de usuario por línea de comandos.<span class="nt">&lt;/td&gt;</span> <span class="nt">&lt;/tr&gt;</span> <span class="nt">&lt;/tbody&gt;</span> <span class="nt">&lt;/table&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Este es un buen momento para refactorizar. Vamos a refactorizar las pruebas para evitar código duplicado. En concreto sacamos la creación del objeto bajo prueba al método <span class="nt">&lt;i&gt;</span>setUp<span class="nt">&lt;/i&gt;</span> tal y como se muestra a continuación.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TestTweetsEnFichero(unittest.TestCase):
def setUp(self):
    self.tef = TweetsEnFichero()
def testCreaNombreFichero(self):
    esperado = &quot;2013-03-30 PyConEs.txt&quot;
    self.assertEquals(esperado, self.tef.crearNombreFichero(&quot;PyConEs&quot;))
def testGetFechaActual(self):
    esperado = &quot;2013-03-30&quot;
    self.assertEquals(esperado, self.tef.getFechaActual())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      También refactorizamos el código de la aplicación para que utilice el método <span class="nt">&lt;i&gt;</span>getFechaActual<span class="nt">&lt;/i&gt;</span> en vez de la fecha incrustada como cadena de texto y el parámetro <span class="nt">&lt;em&gt;</span>hashtag<span class="nt">&lt;/em&gt;</span>.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def crearNombreFichero(self, hashtag):
    return self.getFechaActual() +&quot; &quot;+ hashtag + &quot;.txt&quot;<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Podríamos continuar escribiendo pruebas para que el código añada un cero delante del mes y del día cuando haga falta, pero nuestro código aún depende de la fecha actual del sistema (llamada a <span class="nt">&lt;i&gt;</span>datetime::now<span class="nt">&lt;/i&gt;</span>) lo que aumenta la dificultad de implementar esta funcionalidad. Por ello, nuestro siguiente paso será independizarnos de la fecha del sistema.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;h2&gt;</span>
                      <span class="nt">&lt;b&gt;</span>Funciona hoy, funciona mañana<span class="nt">&lt;/b&gt;</span>
                    <span class="nt">&lt;/h2&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Las pruebas anteriores solo funcionarán hoy, mañana será otro día, <span class="nt">&lt;i&gt;</span>datetime::now<span class="nt">&lt;/i&gt;</span> devolverá otra fecha y las pruebas fallarán. El problema es que hemos incrustado una dependencia con <span class="nt">&lt;i&gt;</span>datetime::now<span class="nt">&lt;/i&gt;</span> en nuestro código, por lo que depende de la llamada al sistema que devuelve la fecha. Necesitamos una manera de romper esa dependencia para poder controlar el código.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      El primer paso es refactorizar para proporcionar el <span class="nt">&lt;i&gt;</span>datetime<span class="nt">&lt;/i&gt;</span> a utilizar desde el exterior. El código resultante se muestra a continuación.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def __init__(self, timeProvider):
    self.timeProvider = timeProvider
def getFechaActual(self):
    now = self.timeProvider.now()
    return str(now.year) + &quot;-&quot; + str(now.month) + &quot;-&quot; + str(now.day)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Después, modificamos las pruebas que tenemos que usen <span class="nt">&lt;i&gt;</span>datetime<span class="nt">&lt;/i&gt;</span> y todo sigue funcionando. Como al final de la sección anterior refactorizamos el código para evitar el código duplicado, solo hemos tenido que modificar una única línea. Si no hubiéramos refactorizado tendríamos que cambiar todas las pruebas. Recuerda, evitar el código duplicado hace tu código más sencillo de cambiar y mejorar.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TestTweetsEnFichero(unittest.TestCase):
def setUp(self):
    self.tef = TweetsEnFichero(datetime)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      ;
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Vamos a continuar modificando las pruebas. Como podemos indicar desde el exterior el encargado de devolver la fecha, podemos crear un “doble” que devuelva siempre la misma fecha. Así podremos saber cuál serán los resultados esperados de la pruebas. Nuestro doble de pruebas se llama <span class="nt">&lt;i&gt;</span>DatetimeStub<span class="nt">&lt;/i&gt;</span> y su misión es reemplazar al <span class="nt">&lt;i&gt;</span>Datetime<span class="nt">&lt;/i&gt;</span> del sistema para devolver siempre la misma fecha. Así, podemos predecir los resultados esperados de la prueba y hacer que no cambien de un día para otro.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class DatetimeStub ():
def now(self):
    self.year = 2013
    self.month = 3
    self.day = 29
    return self<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Los dobles de prueba son un elemento muy poderoso a la hora de escribir pruebas. Al final de este artículo tienes más información sobre dobles. Vamos a modificar la prueba que hemos escrito para utilizar nuestro doble.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TestTweetsEnFichero(unittest.TestCase):
def setUp(self):
    self.tef = TweetsEnFichero(DatetimeStub ())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Todas las pruebas siguen funcionando correctamente. Ya estamos independizados de la fecha y hora.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;h2&gt;</span>
                      <span class="nt">&lt;b&gt;</span>Hazlo pero no me digas cómo<span class="nt">&lt;/b&gt;</span>
                    <span class="nt">&lt;/h2&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Por comodidad, podemos hacer que, si no se indica ningún <span class="nt">&lt;i&gt;</span>datetime<span class="nt">&lt;/i&gt;</span> concreto, se utilice el <span class="nt">&lt;i&gt;</span>datetime<span class="nt">&lt;/i&gt;</span> del sistema. Vamos a escribir una prueba que lo ponga de manifiesto:
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def testGetFechaActual_DatetimePorDefecto(self):
    self.tef = TweetsEnFichero()
    self.assertEquals(datetime, self.tef.timeProvider)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Y ahora implementamos el <span class="nt">&lt;em&gt;</span>datetime<span class="nt">&lt;/em&gt;</span> del sistema por defecto en el constructor  lo utilizamos en el método <span class="nt">&lt;i&gt;</span>getFechaActual<span class="nt">&lt;/i&gt;</span>.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def __init__(self, timeProvider = datetime):
    self.timeProvider = timeProvider
def getFechaActual(self):
    now = self.timeProvider.now()
    return str(now.year) + &quot;-&quot; + &quot;0&quot; + str(now.month) + &quot;-&quot; + str(now.day)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Una vez que todo funciona, continuamos con la siguiente funcionalidad.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;h2&gt;</span>
                      <span class="nt">&lt;b&gt;</span>Un cero a la izquierda<span class="nt">&lt;/b&gt;</span>
                    <span class="nt">&lt;/h2&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Tenemos pendiente en nuestro diario de diseño añadir un “0” cuando el mes y día sean menores de 10. Vamos a escribir nuevas pruebas que nos empujen a implementar esta funcionalidad, por ejemplo la siguiente:
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def testGetFechaActual_ConMesMayorQue10NoSeIncluyeElCero(self):
    self.tef = TweetsEnFichero(DatetimeStub(&quot;12-10-2013&quot;))
    esperado = &quot;2013-10-12&quot;
    self.assertEquals(esperado, self.tef.getFechaActual())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Como se ve en la prueba anterior, necesitamos usar otras fechas distintas que la incluida en nuestro doble de pruebas (clase <span class="nt">&lt;i&gt;</span>DatetimeStub<span class="nt">&lt;/i&gt;</span>). Vamos a modificarlo para que pueda aceptar cualquier fecha como se muestra a continuación.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class DatetimeStub():
def __init__(self, date = &quot;30-3-2013&quot;):
    fields = date.split(&quot;-&quot;)
    self.year = int(fields[2])
    self.month = int(fields[1])
    self.day = int(fields[0])
def now(self):
    return self<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Recuerda que el código de prueba (casos de prueba, dobles, etc.) debe ser lo más sencillo posible por dos motivos. El primero es que no escribimos pruebas para verificar pruebas (ni dobles) por lo que tienen que ser simples y de pocas líneas para evitar fallos. El segundo es que, cuando haya un error en el código, una o varias pruebas fallarán. Queremos entender rápidamente qué hace la prueba para que nos dirijan hacia el error en el código.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Una vez que hemos modificado <span class="nt">&lt;i&gt;</span>DatetimeStub<span class="nt">&lt;/i&gt;</span> y ejecutamos la prueba esta falla, ya que siempre añadimos un “0” delante del mes. Añadimos un if al método <span class="nt">&lt;i&gt;</span>getFechaActual<span class="nt">&lt;/i&gt;</span> y la prueba funciona (veremos este código un poco más adelante).
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Vamos a escribir una segunda prueba que ponga un 0 delante del día. Esta prueba se muestra a continuación.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def testGetFechaActual_ConDiaMenorQue10SeIncluyeUnCero(self):
    self.tef = TweetsEnFichero(DatetimeStub(&quot;7-10-2013&quot;))
    esperado = &quot;2013-10-07&quot;
    self.assertEquals(esperado, self.tef.getFechaActual())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      La prueba falla así que podemos añadir más código. Añadimos otro if para controlar si le ponemos el 0 al día y, con eso, todas las pruebas funcionan ya. El método <span class="nt">&lt;i&gt;</span>getFechaActual<span class="nt">&lt;/i&gt;</span> (con el cambio de añadir un 0 al mes y al día) ha quedado así.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def getFechaActual(self):
    now = self.timeProvider.now()
    month = str(now.month)
    if now.month <span class="ni">&amp;lt;</span> 10:
        month = &quot;0&quot; + month
    day = str(now.day)
    if now.day <span class="ni">&amp;lt;</span> 10:
        day = &quot;0&quot; + day
    return str(now.year) + &quot;-&quot; + month  + &quot;-&quot; + day<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Toca refactorizar. Vemos que el código para añadir un 0 es el mismo y que solo cambia el valor (mes o día). Para evitar duplicar el código extraemos un método auxiliar, al que llamamos <span class="nt">&lt;i&gt;</span>cadenaDosDigitos<span class="nt">&lt;/i&gt;</span>, tal y como se muestra a continuación.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def cadenaDosDigitos(self, num):
    if num <span class="ni">&amp;lt;</span> 10:
        return &quot;0&quot; + str(num)
    return  str(num)
def getFechaActual(self):
    now = self.timeProvider.now()
    return str(now.year)
           + &quot;-&quot; + self.cadenaDosDigitos(now.month)
           + &quot;-&quot; + self.cadenaDosDigitos(now.day)<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                    <span class="nt">&lt;p&gt;</span>
                      Todas las pruebas funcionan por lo que damos por cerrada esta funcionalidad. Repasemos el diario de diseño.
                    <span class="nt">&lt;/p&gt;</span>

                    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;0&quot;</span> <span class="na">cellpadding=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;b&gt;</span>Diario de diseño.<span class="nt">&lt;/b&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                      <span class="nt">&lt;/tr&gt;</span>

                      <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span> <span class="na">width=</span><span class="s">&quot;576&quot;</span><span class="nt">&gt;</span>
                          1) Conectarse a Internet y obtener los mensajes que contengan un tag concreto.<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration:line-through;&quot;</span><span class="nt">&gt;</span>2) Procesar los tweets para obtener el nombre y dirección twitter del autor, la fecha y el contenido del tweet.<span class="nt">&lt;/span&gt;</span>3) Guardarlos tweets procesados en un nuevo fichero<span class="nt">&lt;/p&gt;</span>

                          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration:line-through;&quot;</span><span class="nt">&gt;</span>3.1) Crear el nombre de fichero siguiendo este formato: “año-mes-día tag.txt”<span class="nt">&lt;/span&gt;</span>
                          <span class="nt">&lt;/p&gt;</span>

                          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
                            3.2) Cada tweet se guarda en una línea con los valores separados por comas.
                          <span class="nt">&lt;/p&gt;</span>

                          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
                            3.3) Crear el fichero con el nombre y contenido indicados en 3.1 y 3.2
                          <span class="nt">&lt;/p&gt;</span>

                          <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;padding-left:30px;&quot;</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;text-decoration:line-through;&quot;</span><span class="nt">&gt;</span>3.4) Añadir un “0” cuando el mes o el día sean menores de 10.<span class="nt">&lt;/span&gt;</span>
                          <span class="nt">&lt;/p&gt;</span>

                          <span class="nt">&lt;p&gt;</span>
                            4) Crear una interfaz de usuario por línea de comandos.<span class="nt">&lt;/td&gt;</span> <span class="nt">&lt;/tr&gt;</span> <span class="nt">&lt;/tbody&gt;</span> <span class="nt">&lt;/table&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Hasta aquí llegamos en esta entrada. En la siguiente escribiremos el código que guarde los tweets en el fichero, ya con el nombre correcto.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;h2&gt;</span>
                              <span class="nt">&lt;b&gt;</span>Dobles de prueba<span class="nt">&lt;/b&gt;</span>
                            <span class="nt">&lt;/h2&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Para escribir buenas pruebas unitarias rompemos las dependencias de la clase bajo prueba. Así, centramos la prueba en un único fragmento de código y podemos controlar todas sus interacciones con el entorno, como por ejemplo, con la fecha del sistema. Sabremos que, si la prueba falla, el fallo estará en el código bajo prueba, no en el código de los métodos auxiliares. El diseño queda más flexible ya que no incrustamos dependencias con otras clases dentro de nuestro código.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Para conseguir esta independencia, podemos utilizar versiones ficticias de las clases colaboradoras que devuelvan valores predecibles. Con ello podremos definir los resultados esperados para la prueba.  Estas clases ficticias son dobles de prueba (o <span class="nt">&lt;i&gt;</span>test doubles<span class="nt">&lt;/i&gt;</span> en inglés). A veces también se llaman  mocks, fakes, spies pero en la actualidad dichos nombres se utilizan para indicar dobles de prueba con algunas características especiales.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Antes hemos creado nuestro propio doble de prueba (la clase <span class="nt">&lt;i&gt;</span>DatetimeStub<span class="nt">&lt;/i&gt;</span>), pero existen herramientas que nos facilitan la creación e dobles. Para saber más sobre dobles de prueba consulta la sección logro desbloqueado un poco más adelante.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;h2&gt;</span>
                              <span class="nt">&lt;b&gt;</span>Conclusiones<span class="nt">&lt;/b&gt;</span>
                            <span class="nt">&lt;/h2&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              En esta segunda entrega nos hemos encontrado el problema de depender de una característica del sistema que no podíamos controlar, la fecha, y cómo hemos evolucionado nuestro diseño. El código resultante que hemos creado en esta entrada se muestra a continuación
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>class TweetsEnFichero:
def __init__(self, timeProvider = datetime):
    self.timeProvider = timeProvider
def _getFechaActual(self):
    now = self.timeProvider.now()
    return str(now.year)
        + &quot;-&quot; + self._cadenaDosDigitos(now.month)
        + &quot;-&quot; + self._cadenaDosDigitos(now.day)
def _cadenaDosDigitos(self, num):
    pre = &quot;&quot;
    if num <span class="ni">&amp;lt;</span> 10:
        pre = &quot;0&quot;
    return  pre+ str(num)
def crearNombreFichero(self, hashtag):
    return self._getFechaActual() +&quot; &quot;+ hashtag + &quot;.txt&quot;<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Test-Driven Development nos ha ayudado a llegar hasta un mejor diseño al detectar la necesidad de extraer la dependencia del <span class="nt">&lt;i&gt;</span>datetime<span class="nt">&lt;/i&gt;</span> del sistema para poder escribir pruebas. Nos vemos en la próxima entrada.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;h2&gt;</span>
                              <span class="nt">&lt;b&gt;</span>Logro desbloqueado<span class="nt">&lt;/b&gt;</span>
                            <span class="nt">&lt;/h2&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              En este ejemplo hemos creado nuestros propios dobles de prueba, pero existen varias librerías que automatizan este trabajo por nosotros. En Python, a partir de la versión 3.3, incorpora una librería de mocks llamada MagicMocks y que también se puede utilizar de manera independiente. Utilizando esta librería, nuestro ejemplo quedaría de la siguiente manera.
                            <span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;language-python&quot;</span><span class="nt">&gt;</span>def testGetFechaActual_ConMesMayorQue10NoSeIncluyeElCero(self):
    datetimeStub = Mock()
    datetimeStub.year = 2013
    datetimeStub.month = 3
    datetimeStub.day = 30
    datetimeStub.now = Mock(return_value=datetimeStub)
    tef = TweetsEnFichero(datetimeStub)
       esperado = &quot;2013-03-30&quot;
    self.assertEquals(esperado, tef.getFechaActual())<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>

                            <span class="nt">&lt;p&gt;</span>
                              Y ya no es necesario crear la clase DatetimeStub. Puedes leer más sobre dobles de prueba y Python en el blog del autor: <span class="nt">&lt;a</span> <span class="na">title=</span><span class="s">&quot;Un ejemplo de Mocks en Python (con Mockito y MagicMock)&quot;</span> <span class="na">href=</span><span class="s">&quot;http://iwt2-javierj.tumblr.com/post/36695988608/mocks-en-python-previa-python-tdd&quot;</span><span class="nt">&gt;</span>Un ejemplo de Mocks en Python (con Mockito y MagicMock)<span class="nt">&lt;/a&gt;</span>.  También puedes encontrar más teoría (muy resumida y con ejemplos en Java) sobre el mundo de los dobles de prueba en el libro inconcluso <span class="nt">&lt;a</span> <span class="na">title=</span><span class="s">&quot;Desarrollo Dirigido por Pruebas Práctico&quot;</span> <span class="na">href=</span><span class="s">&quot;http://www.iwt2.org/web/opencms/IWT2/comunidad/LibroTDD/?locale=es&quot;</span><span class="nt">&gt;</span>Desarrollo Dirigido por Pruebas Práctico<span class="nt">&lt;/a&gt;</span>. Por último, tienes otro ejemplo de cómo aislarte de la dependencia de la fecha del sistema en Python aquí: <span class="nt">&lt;a</span> <span class="na">title=</span><span class="s">&quot;Cómo aislarnos de las dependencias del sistema. Un caso práctico con Python, MagicMock y TDD&quot;</span> <span class="na">href=</span><span class="s">&quot;http://iwt2-javierj.tumblr.com/post/67646801575/como-aislarnos-de-las-dependencias-del-sistema-un-caso&quot;</span><span class="nt">&gt;</span>Cómo aislarnos de las dependencias del sistema. Un caso práctico con Python, MagicMock y TDD<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/p&gt;</span>
</pre></div>
        </div>

        <div class="meta">
            <div class="tags">
            </div>
        </div>


    </article>
<script data-isso="//https://comments.pybonacci.org"
        data-isso-lang="es"
        src="//https://comments.pybonacci.org/js/embed.min.js"></script>
<section id="isso-thread">
<h3>Comentarios</h3>
</section>

</div>

<style type="text/css">
{
    max-width: 700px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
    margin: .2em 0.4em;
    max-width: 580px;
}

table.dataframe {
    font-family: Arial, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

        </div>

        <footer class="disclaimer">
          <div class="container-fluid">
            <p>
              © 2012-2017 Pybonacci, licencia <a href="https://github.com/Pybonacci/pybonacci.github.io/blob/sources/LICENSE.md"> CC BY-SA 4.0 + MIT</a>
              salvo otra indicación.
              <p>Contenido generado con <a href= "http://docs.getpelican.com/">Pelican</a>.</p>
            </p>
          </div>
        </footer>

    </body>
</html>